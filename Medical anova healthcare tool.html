<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intermediate Series: ANOVA in Healthcare & Clinical Group Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400;600;700;900&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,600;0,700;1,400&family=Fira+Code:wght@400;500;700&family=Cormorant:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        :root {
            --primary-teal: #00ACC1;
            --secondary-red: #DC2626;
            --light-teal: #4DD0E1;
            --pale-teal: #E0F7FA;
            --deep-teal: #00838F;
            --cyan: #00BCD4;
            --aqua: #80DEEA;
            --medical-blue: #1976D2;
            --clinical-orange: #FF8F00;
            --health-green: #43A047;
            --silver: #CFD8DC;
            --charcoal: #263238;
            --slate: #546E7A;
            --cream: #FAFAFA;
            --white: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: linear-gradient(135deg, var(--cream) 0%, #F0FDFF 50%, var(--pale-teal) 100%);
            color: var(--charcoal);
            line-height: 1.75;
            overflow-x: hidden;
            position: relative;
        }

        /* Clinical Group Analysis Flow Background */
        body::before {
            content: '';
            position: fixed;
            top: -85%;
            left: -85%;
            width: 270%;
            height: 270%;
            background: 
                radial-gradient(ellipse at 25% 25%, rgba(0, 172, 193, 0.06) 0%, transparent 75%),
                radial-gradient(ellipse at 75% 75%, rgba(77, 208, 225, 0.08) 0%, transparent 70%),
                radial-gradient(ellipse at 90% 15%, rgba(25, 118, 210, 0.05) 0%, transparent 65%),
                radial-gradient(ellipse at 15% 90%, rgba(255, 143, 0, 0.04) 0%, transparent 60%);
            animation: groupAnalysisFlow 55s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes groupAnalysisFlow {
            0%, 100% { 
                transform: rotate(0deg) scale(1) translate(0, 0); 
                opacity: 0.8; 
            }
            25% { 
                transform: rotate(90deg) scale(1.15) translate(35px, -35px); 
                opacity: 1; 
            }
            50% { 
                transform: rotate(180deg) scale(0.85) translate(-28px, 28px); 
                opacity: 0.85; 
            }
            75% { 
                transform: rotate(270deg) scale(1.1) translate(25px, -18px); 
                opacity: 0.95; 
            }
        }

        /* ANOVA Analysis Pattern */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(60deg, 
                    transparent 0px, 
                    rgba(0, 172, 193, 0.025) 1px, 
                    transparent 2px, 
                    transparent 90px),
                repeating-linear-gradient(-30deg, 
                    transparent 0px, 
                    rgba(77, 208, 225, 0.02) 1px, 
                    transparent 2px, 
                    transparent 110px);
            z-index: -1;
            animation: anovaGrid 42s linear infinite;
        }

        @keyframes anovaGrid {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(90px) translateY(110px); }
        }

        .container {
            max-width: 1950px;
            margin: 35px auto;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 
                0 0 95px rgba(0, 172, 193, 0.15),
                0 35px 85px rgba(77, 208, 225, 0.13),
                0 25px 45px rgba(25, 118, 210, 0.11);
            border-radius: 50px;
            overflow: hidden;
            backdrop-filter: blur(22px);
            animation: anovaEntry 3.3s cubic-bezier(0.23, 1, 0.32, 1);
            border: 1px solid rgba(0, 172, 193, 0.2);
        }

        @keyframes anovaEntry {
            from {
                opacity: 0;
                transform: scale(0.82) translateY(85px) rotateX(22deg);
                filter: blur(22px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0) rotateX(0deg);
                filter: blur(0);
            }
        }

        /* Clinical Group Analysis Header Design */
        .header-section {
            background: linear-gradient(135deg, var(--charcoal) 0%, var(--primary-teal) 35%, var(--deep-teal) 70%, #004D5C 100%);
            color: white;
            padding: 75px 65px;
            position: relative;
            overflow: hidden;
        }

        .header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(85deg, 
                transparent 0%, 
                rgba(77, 208, 225, 0.18) 8%, 
                transparent 22%, 
                rgba(25, 118, 210, 0.15) 38%, 
                transparent 52%, 
                rgba(255, 143, 0, 0.12) 68%, 
                transparent 82%);
            animation: groupAnalysisHeader 19s ease-in-out infinite;
        }

        @keyframes groupAnalysisHeader {
            0%, 100% { 
                transform: translateX(-130px) scaleY(1) rotate(0deg); 
                opacity: 0.85; 
            }
            33% { 
                transform: translateX(85px) scaleY(1.35) rotate(1.8deg); 
                opacity: 1; 
            }
            66% { 
                transform: translateX(-55px) scaleY(0.75) rotate(-1.2deg); 
                opacity: 0.9; 
            }
        }

        .header-title {
            font-family: 'Roboto Slab', serif;
            font-size: 5.1em;
            font-weight: 900;
            margin-bottom: 38px;
            text-shadow: 5px 7px 20px rgba(0,0,0,0.65);
            position: relative;
            z-index: 2;
            background: linear-gradient(135deg, white 0%, var(--aqua) 25%, #87CEEB 55%, white 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleAnova 5.2s ease-in-out infinite alternate;
            letter-spacing: -3.2px;
        }

        @keyframes titleAnova {
            from { 
                filter: drop-shadow(0 0 25px rgba(77, 208, 225, 0.75)); 
                text-shadow: 0 0 55px rgba(0, 172, 193, 0.55);
            }
            to { 
                filter: drop-shadow(0 0 40px rgba(0, 172, 193, 0.9)); 
                text-shadow: 0 0 70px rgba(0, 131, 143, 0.65);
            }
        }

        .header-subtitle {
            font-size: 2.4em;
            font-weight: 400;
            opacity: 0.95;
            position: relative;
            z-index: 2;
            color: var(--aqua);
            text-shadow: 4px 5px 18px rgba(0,0,0,0.55);
            letter-spacing: 1.6px;
            font-style: italic;
        }

        /* Clinical Group Analysis Navigation */
        .nav-tabs {
            display: flex;
            background: linear-gradient(90deg, var(--primary-teal) 0%, var(--medical-blue) 15%, var(--clinical-orange) 30%, var(--health-green) 45%, var(--cyan) 60%, var(--deep-teal) 75%, var(--primary-teal) 90%, var(--deep-teal) 100%);
            padding: 0;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 7px 0 rgba(77, 208, 225, 0.8);
        }

        .nav-tabs::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 60%;
            background: linear-gradient(90deg, 
                rgba(255,255,255,0.14) 0%, 
                rgba(77, 208, 225, 0.25) 50%, 
                rgba(255,255,255,0.14) 100%);
            transform: translateX(-250%);
            animation: groupAnalysisNav 14s ease-in-out infinite;
        }

        @keyframes groupAnalysisNav {
            0%, 100% { transform: translateX(-250%); }
            50% { transform: translateX(600%); }
        }

        .tab-button {
            flex: 1;
            padding: 42px 48px;
            background: none;
            border: none;
            color: white;
            font-weight: 500;
            font-size: 1.35em;
            cursor: pointer;
            transition: all 0.9s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 8px solid transparent;
            position: relative;
            z-index: 2;
            letter-spacing: 1.1px;
        }

        .tab-button:hover {
            background: rgba(77, 208, 225, 0.28);
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.35);
            color: var(--cream);
        }

        .tab-button.active {
            background: rgba(77, 208, 225, 0.38);
            border-bottom-color: var(--clinical-orange);
            font-weight: 600;
            color: var(--cream);
            box-shadow: inset 0 -8px 0 var(--clinical-orange);
        }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 85px;
            animation: groupAnalysisSlide 1.8s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .content-section.active {
            display: block;
        }

        @keyframes groupAnalysisSlide {
            from {
                opacity: 0;
                transform: translateY(70px) scale(0.93);
                filter: blur(12px);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: blur(0);
            }
        }

        /* Section Titles - RED (Consistency) */
        .section-title {
            font-family: 'Roboto Slab', serif;
            font-size: 4.8em;
            color: var(--secondary-red);
            margin-bottom: 75px;
            text-align: center;
            font-weight: 700;
            position: relative;
            text-shadow: 4px 5px 18px rgba(0,0,0,0.18);
            letter-spacing: -2.8px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 280px;
            height: 7px;
            background: linear-gradient(90deg, 
                var(--aqua) 0%, 
                var(--medical-blue) 12%, 
                var(--clinical-orange) 24%, 
                var(--health-green) 36%, 
                var(--cyan) 48%, 
                var(--primary-teal) 60%, 
                var(--light-teal) 72%, 
                var(--deep-teal) 84%, 
                var(--aqua) 100%);
            border-radius: 6px;
            animation: groupAnalysisUnderline 7.5s ease-in-out infinite alternate;
        }

        @keyframes groupAnalysisUnderline {
            from { width: 280px; opacity: 0.8; }
            to { width: 420px; opacity: 1; }
        }

        /* Medical Teal/Cyan Boxes - Intermediate Framework */
        .theory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(580px, 1fr));
            gap: 65px;
            margin-bottom: 85px;
        }

        .theory-card {
            background: linear-gradient(135deg, var(--pale-teal) 0%, #F0FDFF 50%, var(--white) 100%);
            padding: 65px;
            border-radius: 38px;
            border: 6px solid var(--light-teal);
            box-shadow: 
                0 30px 80px rgba(0, 172, 193, 0.14),
                0 15px 40px rgba(77, 208, 225, 0.16);
            transition: all 1.0s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .theory-card::before {
            content: '';
            position: absolute;
            top: -55px;
            right: -55px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, 
                rgba(77, 208, 225, 0.14) 0%, 
                rgba(0, 172, 193, 0.12) 40%, 
                transparent 70%);
            border-radius: 50%;
            animation: cardAnova 11s ease-in-out infinite;
        }

        @keyframes cardAnova {
            0%, 100% { 
                transform: scale(1) translateX(0) translateY(0) rotate(0deg); 
                opacity: 0.9; 
            }
            25% { 
                transform: scale(1.25) translateX(35px) translateY(-35px) rotate(90deg); 
                opacity: 1; 
            }
            50% { 
                transform: scale(0.75) translateX(-25px) translateY(25px) rotate(180deg); 
                opacity: 0.85; 
            }
            75% { 
                transform: scale(1.2) translateX(25px) translateY(-15px) rotate(270deg); 
                opacity: 0.95; 
            }
        }

        .theory-card:hover {
            transform: translateY(-22px);
            box-shadow: 
                0 40px 110px rgba(0, 172, 193, 0.2),
                0 22px 55px rgba(77, 208, 225, 0.25);
            border-color: var(--primary-teal);
        }

        .theory-card h3 {
            font-family: 'Roboto Slab', serif;
            color: var(--secondary-red);
            margin-bottom: 40px;
            font-size: 2.6em;
            font-weight: 700;
            position: relative;
            z-index: 2;
            letter-spacing: -1.2px;
        }

        .theory-card p {
            font-size: 1.4em;
            line-height: 2.0;
            margin-bottom: 22px;
            position: relative;
            z-index: 2;
            font-weight: 400;
        }

        /* Mathematical Formulas - Group Analysis Style */
        .formula-display {
            background: linear-gradient(135deg, var(--charcoal) 0%, var(--primary-teal) 50%, var(--deep-teal) 100%);
            color: white;
            padding: 55px;
            border-radius: 32px;
            margin: 48px 0;
            font-family: 'Fira Code', monospace;
            font-size: 1.45em;
            box-shadow: 
                inset 0 6px 35px rgba(0,0,0,0.7), 
                0 25px 65px rgba(0, 172, 193, 0.4);
            overflow-x: auto;
            border: 6px solid rgba(77, 208, 225, 0.7);
            position: relative;
        }

        .formula-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                var(--aqua) 12%, 
                var(--medical-blue) 24%, 
                var(--clinical-orange) 36%, 
                var(--health-green) 48%, 
                var(--cyan) 60%, 
                var(--light-teal) 72%, 
                transparent 100%);
            animation: formulaAnova 6.0s ease-in-out infinite;
        }

        @keyframes formulaAnova {
            0%, 100% { opacity: 0.7; transform: scaleX(0.6); }
            50% { opacity: 1; transform: scaleX(2.0); }
        }

        /* Medical Teal Control Panel */
        .control-panel {
            background: linear-gradient(135deg, var(--pale-teal) 0%, #F0FDFF 50%, var(--white) 100%);
            padding: 75px;
            border-radius: 45px;
            margin: 75px 0;
            border: 7px solid var(--light-teal);
            box-shadow: 
                0 40px 110px rgba(77, 208, 225, 0.22),
                inset 0 1px 0 rgba(255,255,255,0.99);
            position: relative;
            overflow: hidden;
        }

        .control-panel::before {
            content: '';
            position: absolute;
            top: -130%;
            left: -130%;
            width: 360%;
            height: 360%;
            background: conic-gradient(from 75deg at 50% 50%, 
                transparent 0%, 
                rgba(77, 208, 225, 0.08) 18%, 
                transparent 36%, 
                rgba(0, 172, 193, 0.06) 54%, 
                transparent 72%);
            animation: controlAnova 28s linear infinite;
        }

        @keyframes controlAnova {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .control-header {
            font-family: 'Roboto Slab', serif;
            color: var(--secondary-red);
            font-size: 3.8em;
            margin-bottom: 55px;
            text-align: center;
            font-weight: 700;
            position: relative;
            z-index: 2;
            letter-spacing: -1.2px;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(460px, 1fr));
            gap: 50px;
            margin-bottom: 65px;
            position: relative;
            z-index: 2;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 25px;
            color: var(--charcoal);
            font-size: 1.35em;
            letter-spacing: 0.6px;
        }

        .form-group select,
        .form-group input {
            padding: 32px;
            border: 2px solid #E5E7EB;
            border-radius: 25px;
            font-size: 1.3em;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 8px 26px rgba(0,0,0,0.08);
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--primary-teal);
            box-shadow: 
                0 0 40px rgba(0, 172, 193, 0.4),
                0 0 0 6px rgba(77, 208, 225, 0.22);
            transform: translateY(-4px) scale(1.03);
        }

        /* Clinical Group Analysis Action Buttons */
        .button-group {
            display: flex;
            gap: 40px;
            margin-top: 65px;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .btn {
            padding: 36px 75px;
            border: none;
            border-radius: 28px;
            font-weight: 600;
            font-size: 1.4em;
            cursor: pointer;
            transition: all 0.9s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 2.6px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.8) 50%, 
                transparent 100%);
            transition: left 1.2s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-teal) 0%, var(--deep-teal) 100%);
            color: white;
            box-shadow: 0 16px 48px rgba(0, 172, 193, 0.5);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--deep-teal) 0%, var(--primary-teal) 100%);
            transform: translateY(-10px);
            box-shadow: 0 24px 70px rgba(0, 172, 193, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--medical-blue) 0%, #1565C0 100%);
            color: white;
            box-shadow: 0 16px 48px rgba(25, 118, 210, 0.5);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #1565C0 0%, var(--medical-blue) 100%);
            transform: translateY(-10px);
            box-shadow: 0 24px 70px rgba(25, 118, 210, 0.6);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--clinical-orange) 0%, #F57C00 100%);
            color: white;
            box-shadow: 0 16px 48px rgba(255, 143, 0, 0.5);
        }

        .btn-accent:hover {
            background: linear-gradient(135deg, #F57C00 0%, var(--clinical-orange) 100%);
            transform: translateY(-10px);
            box-shadow: 0 24px 70px rgba(255, 143, 0, 0.6);
        }

        /* Medical Teal Results Container */
        .results-container {
            background: linear-gradient(135deg, var(--pale-teal) 0%, #F0FDFF 100%);
            border: 7px solid var(--light-teal);
            border-radius: 42px;
            padding: 75px;
            margin: 75px 0;
            box-shadow: 
                0 40px 120px rgba(0,0,0,0.18),
                inset 0 1px 0 rgba(255,255,255,0.99);
            position: relative;
            overflow: hidden;
        }

        .results-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, 
                var(--aqua) 0%, 
                var(--medical-blue) 10%, 
                var(--clinical-orange) 20%, 
                var(--health-green) 30%, 
                var(--cyan) 40%, 
                var(--primary-teal) 50%, 
                var(--light-teal) 60%, 
                var(--deep-teal) 70%, 
                var(--cyan) 80%, 
                var(--aqua) 100%);
            animation: groupAnalysisResults 6.0s ease-in-out infinite;
        }

        @keyframes groupAnalysisResults {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .results-header {
            font-family: 'Roboto Slab', serif;
            font-size: 4.0em;
            color: var(--secondary-red);
            margin-bottom: 55px;
            text-align: center;
            font-weight: 700;
            letter-spacing: -1.2px;
        }

        /* Medical Teal Chart Container */
        .chart-container {
            position: relative;
            height: 800px;
            margin: 75px 0;
            background: linear-gradient(135deg, var(--pale-teal) 0%, var(--white) 100%);
            border-radius: 38px;
            padding: 65px;
            box-shadow: 0 30px 85px rgba(0,0,0,0.18);
            border: 6px solid var(--light-teal);
        }

        /* Statistics Grid - Medical Teal Theme */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 55px;
            margin: 68px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--pale-teal) 0%, var(--white) 100%);
            padding: 50px;
            border-radius: 30px;
            text-align: center;
            border: 6px solid var(--light-teal);
            transition: all 0.9s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--aqua) 0%, var(--primary-teal) 50%, var(--medical-blue) 100%);
            transform: scaleX(0);
            transition: transform 0.8s ease;
        }

        .stat-card:hover {
            transform: translateY(-18px) scale(1.05);
            box-shadow: 0 35px 90px rgba(0,0,0,0.22);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-value {
            font-family: 'Fira Code', monospace;
            font-size: 2.8em;
            font-weight: 700;
            color: var(--primary-teal);
            margin-bottom: 22px;
        }

        .stat-label {
            font-size: 1.3em;
            color: var(--slate);
            font-weight: 500;
        }

        /* ANOVA-Specific Elements */
        .anova-info {
            background: linear-gradient(135deg, var(--pale-teal) 0%, #F0F8FF 100%);
            border: 6px solid var(--light-teal);
            border-radius: 28px;
            padding: 50px;
            margin: 50px 0;
        }

        .anova-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 32px;
            margin: 42px 0;
        }

        .anova-metric-card {
            background: var(--primary-teal);
            color: white;
            padding: 32px 24px;
            border-radius: 22px;
            text-align: center;
            font-family: 'Fira Code', monospace;
            font-size: 1.2em;
            font-weight: 600;
        }

        .anova-metric-card:nth-child(1) { background: var(--medical-blue); }
        .anova-metric-card:nth-child(2) { background: var(--clinical-orange); }
        .anova-metric-card:nth-child(3) { background: var(--primary-teal); }
        .anova-metric-card:nth-child(4) { background: var(--health-green); }

        /* Decision Framework - Medical Teal */
        .decision-panel {
            background: linear-gradient(135deg, var(--pale-teal) 0%, rgba(77, 208, 225, 0.35) 100%);
            border: 7px solid var(--light-teal);
            border-radius: 40px;
            padding: 65px;
            margin: 65px 0;
        }

        .decision-question {
            font-family: 'Roboto Slab', serif;
            font-weight: 600;
            font-size: 1.9em;
            margin-bottom: 50px;
            color: var(--charcoal);
            text-align: center;
            letter-spacing: -0.6px;
        }

        .decision-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
            gap: 40px;
        }

        .decision-option {
            padding: 40px;
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 26px;
            cursor: pointer;
            transition: all 0.8s ease;
            text-align: center;
            font-weight: 500;
            font-size: 1.3em;
        }

        .decision-option:hover {
            border-color: var(--medical-blue);
            background: #E1F5FE;
            transform: translateY(-8px);
        }

        .decision-option.selected {
            border-color: var(--primary-teal);
            background: var(--pale-teal);
            box-shadow: 0 0 50px rgba(0, 172, 193, 0.5);
        }

        /* Feedback Messages */
        .feedback-message {
            padding: 50px;
            border-radius: 30px;
            margin: 50px 0;
            font-weight: 500;
            font-size: 1.4em;
        }

        .feedback-success {
            background: var(--pale-teal);
            border: 6px solid var(--light-teal);
            color: var(--deep-teal);
        }

        .feedback-warning {
            background: #FFF8E1;
            border: 6px solid var(--clinical-orange);
            color: #8F6300;
        }

        .feedback-danger {
            background: #FFEBEE;
            border: 6px solid #DC2626;
            color: #8B0000;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 30px;
                border-radius: 42px;
            }

            .header-title {
                font-size: 4.0em;
            }

            .theory-grid {
                grid-template-columns: 1fr;
            }

            .control-group {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .button-group {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .anova-metrics {
                grid-template-columns: 1fr;
            }
        }

        /* Research References - Medical Teal */
        .research-note {
            background: linear-gradient(135deg, var(--pale-teal) 0%, #F0F8FF 100%);
            padding: 50px;
            border-radius: 26px;
            margin: 50px 0;
            border-left: 12px solid var(--primary-teal);
            font-style: italic;
            position: relative;
        }

        .research-note::before {
            content: 'üìä';
            position: absolute;
            top: 50px;
            left: 42px;
            font-size: 1.9em;
        }

        .research-note p {
            margin-left: 65px;
            line-height: 2.1;
        }

        /* Advanced Visual Effects */
        .group-analysis-highlight {
            background: rgba(0, 172, 193, 0.16);
            border-left: 10px solid var(--primary-teal);
            padding: 30px;
            margin: 30px 0;
            border-radius: 16px;
        }

        .f-statistic-display {
            display: inline-block;
            background: linear-gradient(135deg, var(--light-teal) 0%, var(--primary-teal) 100%);
            color: white;
            padding: 16px 30px;
            border-radius: 35px;
            font-family: 'Fira Code', monospace;
            font-weight: 700;
            margin: 0 16px;
            font-size: 1.2em;
        }

        /* Canadian Healthcare Context */
        .canada-anova {
            background: linear-gradient(135deg, #FF6B6B 0%, #DC2626 100%);
            color: white;
            padding: 14px 26px;
            border-radius: 26px;
            font-family: 'Fira Code', monospace;
            font-weight: 600;
            font-size: 0.96em;
            display: inline-block;
            margin: 0 14px;
        }

        /* Post-hoc Analysis Visualization */
        .posthoc-info {
            display: flex;
            justify-content: space-between;
            background: var(--pale-teal);
            padding: 35px;
            border-radius: 20px;
            margin: 35px 0;
        }

        .posthoc-metric {
            background: var(--primary-teal);
            color: white;
            padding: 22px 30px;
            border-radius: 16px;
            text-align: center;
            flex: 1;
            margin: 0 14px;
            font-family: 'Fira Code', monospace;
            font-weight: 600;
            font-size: 1.1em;
        }

        .posthoc-metric:first-child {
            background: var(--medical-blue);
        }

        .posthoc-metric:nth-child(2) {
            background: var(--clinical-orange);
        }

        .posthoc-metric:last-child {
            background: var(--health-green);
        }

        /* ANOVA Steps */
        .anova-steps {
            background: var(--pale-teal);
            padding: 40px;
            border-radius: 24px;
            margin: 40px 0;
            border: 5px solid var(--light-teal);
        }

        .step-item {
            display: flex;
            align-items: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        }

        .step-number {
            background: var(--primary-teal);
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 20px;
            font-family: 'Fira Code', monospace;
        }

        .step-text {
            font-weight: 500;
            color: var(--charcoal);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header-section">
            <h1 class="header-title">ANOVA in Healthcare & Clinical Group Analysis</h1>
            <p class="header-subtitle">Intermediate Series: Advanced Group Comparisons for Medical Research</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-button active" onclick="showSection('theory')">üìä ANOVA Theory</button>
            <button class="tab-button" onclick="showSection('simulation')">üá®üá¶ Clinical Group Analysis</button>
            <button class="tab-button" onclick="showSection('analysis')">üîç Model Diagnostics</button>
            <button class="tab-button" onclick="showSection('assessment')">‚úÖ Assessment Mode</button>
        </div>

        <!-- Theory Framework Section -->
        <div id="theory" class="content-section active">
            <h2 class="section-title">ANOVA Framework for Healthcare</h2>
            
            <div class="theory-grid">
                <div class="theory-card">
                    <h3>üìä One-Way ANOVA Theory</h3>
                    <p><strong>Multiple Group Comparison:</strong> One-way ANOVA tests whether means of three or more groups differ significantly, essential for comparing treatment effectiveness across multiple medical interventions.</p>
                    <div class="formula-display">
                        ANOVA Model:<br>
                        Y·µ¢‚±º = Œº + Œ±·µ¢ + Œµ·µ¢‚±º<br><br>
                        F-statistic:<br>
                        F = MSB / MSW = [Œ£n·µ¢(xÃÑ·µ¢ - xÃÑ)¬≤/(k-1)] / [Œ£Œ£(x·µ¢‚±º - xÃÑ·µ¢)¬≤/(N-k)]<br><br>
                        Where:<br>
                        MSB = Mean Square Between groups<br>
                        MSW = Mean Square Within groups<br>
                        k = number of groups, N = total sample size
                    </div>
                    <p><em>Clinical insight: F-statistic compares variation between treatment groups to variation within groups</em></p>
                </div>

                <div class="theory-card">
                    <h3>üî¨ Two-Way ANOVA Applications</h3>
                    <p><strong>Factorial Design:</strong> Two-way ANOVA examines effects of two factors simultaneously and their interaction, crucial for understanding complex medical treatment combinations.</p>
                    <div class="formula-display">
                        Two-Way Model:<br>
                        Y·µ¢‚±º‚Çñ = Œº + Œ±·µ¢ + Œ≤‚±º + (Œ±Œ≤)·µ¢‚±º + Œµ·µ¢‚±º‚Çñ<br><br>
                        Sources of Variation:<br>
                        ‚Ä¢ Main effect A: Factor 1<br>
                        ‚Ä¢ Main effect B: Factor 2<br>
                        ‚Ä¢ Interaction A√óB: Combined effect<br><br>
                        Interaction interpretation:<br>
                        Effect of Factor A depends on level of Factor B
                    </div>
                    <p><strong>Medical Example:</strong> Drug effectiveness (Factor A) varies by patient age group (Factor B), requiring interaction analysis</p>
                </div>

                <div class="theory-card">
                    <h3>üéØ Post-hoc Testing & Multiple Comparisons</h3>
                    <p><strong>Pairwise Comparisons:</strong> After significant ANOVA, post-hoc tests identify which specific groups differ while controlling for multiple comparison error inflation.</p>
                    <div class="formula-display">
                        Multiple Comparison Methods:<br><br>
                        Tukey HSD: q = (xÃÑ·µ¢ - xÃÑ‚±º) / ‚àö(MSW/n)<br>
                        Bonferroni: Œ±' = Œ± / C (C = # comparisons)<br>
                        ≈†√≠d√°k: Œ±' = 1 - (1-Œ±)^(1/C)<br><br>
                        Family-wise Error Rate (FWER):<br>
                        Probability of at least one Type I error<br>
                        across all comparisons
                    </div>
                    <p><strong>Clinical Application:</strong> Compare all treatment pairs while maintaining overall Œ± = 0.05 for clinical trial integrity</p>
                </div>

                <div class="theory-card">
                    <h3>üìê ANOVA Assumptions & Diagnostics</h3>
                    <p><strong>Model Validity:</strong> ANOVA requires independence, normality, and equal variances. Violation assessment and remedial measures ensure reliable clinical conclusions.</p>
                    <div class="formula-display">
                        Key Assumptions:<br>
                        1. Independence of observations<br>
                        2. Normality within groups<br>
                        3. Homogeneity of variance (homoscedasticity)<br><br>
                        Diagnostic Tests:<br>
                        ‚Ä¢ Shapiro-Wilk test: Normality<br>
                        ‚Ä¢ Levene's test: Equal variances<br>
                        ‚Ä¢ Residual plots: Pattern detection<br><br>
                        Remedial Measures:<br>
                        ‚Ä¢ Transformations (log, sqrt)<br>
                        ‚Ä¢ Non-parametric alternatives<br>
                        ‚Ä¢ Robust methods
                    </div>
                    <p><strong>Clinical Consequences:</strong> Assumption violations lead to incorrect p-values and unreliable medical conclusions</p>
                </div>

                <div class="theory-card">
                    <h3>üìè Effect Sizes & Clinical Significance</h3>
                    <p><strong>Practical Importance:</strong> Effect sizes quantify the magnitude of group differences, distinguishing statistical significance from clinical relevance in medical research.</p>
                    <div class="formula-display">
                        Effect Size Measures:<br><br>
                        Eta-squared (Œ∑¬≤):<br>
                        Œ∑¬≤ = SSB / SST<br><br>
                        Omega-squared (œâ¬≤):<br>
                        œâ¬≤ = (SSB - (k-1)√óMSW) / (SST + MSW)<br><br>
                        Cohen's interpretation:<br>
                        Small: Œ∑¬≤ = 0.01, Medium: Œ∑¬≤ = 0.06<br>
                        Large: Œ∑¬≤ = 0.14<br><br>
                        Partial Œ∑¬≤ for multifactor designs
                    </div>
                    <p><strong>Medical Interpretation:</strong> Large effect size (Œ∑¬≤ > 0.14) suggests clinically meaningful treatment differences beyond statistical significance</p>
                </div>

                <div class="theory-card">
                    <h3>üè• ANCOVA & Covariate Control</h3>
                    <p><strong>Confounder Adjustment:</strong> ANCOVA combines ANOVA with regression to control for continuous covariates, increasing precision in medical group comparisons.</p>
                    <div class="formula-display">
                        ANCOVA Model:<br>
                        Y·µ¢‚±º = Œº + Œ±·µ¢ + Œ≤(X·µ¢‚±º - xÃÑ) + Œµ·µ¢‚±º<br><br>
                        Where:<br>
                        X·µ¢‚±º = covariate value<br>
                        Œ≤ = regression coefficient<br><br>
                        Benefits:<br>
                        ‚Ä¢ Reduces error variance<br>
                        ‚Ä¢ Controls for baseline differences<br>
                        ‚Ä¢ Increases statistical power<br><br>
                        Assumptions:<br>
                        ‚Ä¢ Linear relationship<br>
                        ‚Ä¢ Homogeneity of regression slopes
                    </div>
                    <p><strong>Clinical Use:</strong> Control for baseline health status when comparing treatment outcomes in non-randomized studies</p>
                </div>
            </div>

            <div class="theory-card" style="grid-column: 1 / -1;">
                <h3>üá®üá¶ Canadian Clinical Group Analysis Applications</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 55px; margin-top: 45px;">
                    <div>
                        <h4>üè• Clinical Trial Analysis:</h4>
                        <ul>
                            <li><strong>Multi-arm Treatment Trials:</strong> Compare multiple drug dosages simultaneously</li>
                            <li><strong>Device Effectiveness Studies:</strong> Evaluate different medical device types</li>
                            <li><strong>Intervention Comparison:</strong> Assess various therapeutic approaches</li>
                            <li><strong>Dose-Response Analysis:</strong> Optimize medication dosing strategies</li>
                        </ul>
                    </div>
                    <div>
                        <h4>üìä Healthcare System Analysis:</h4>
                        <ul>
                            <li><strong>Hospital Performance Comparison:</strong> Quality metrics across regions</li>
                            <li><strong>Population Health Studies:</strong> Health outcomes by demographic groups</li>
                            <li><strong>Provider Effectiveness:</strong> Clinical outcomes across practice types</li>
                            <li><strong>Policy Impact Assessment:</strong> Health program effectiveness evaluation</li>
                        </ul>
                    </div>
                </div>

                <div class="anova-steps" style="margin-top: 45px;">
                    <h4 style="color: var(--secondary-red); margin-bottom: 30px; text-align: center;">üìä ANOVA Analysis Process</h4>
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <div class="step-text"><strong>Study Design:</strong> Define groups, outcomes, and sampling strategy</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">2</div>
                        <div class="step-text"><strong>Assumption Checking:</strong> Test normality, equal variances, and independence</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-text"><strong>ANOVA Testing:</strong> Calculate F-statistic and assess significance</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">4</div>
                        <div class="step-text"><strong>Effect Size Calculation:</strong> Determine practical significance magnitude</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">5</div>
                        <div class="step-text"><strong>Post-hoc Testing:</strong> Identify specific group differences if significant</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">6</div>
                        <div class="step-text"><strong>Clinical Interpretation:</strong> Translate statistical findings to medical practice</div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">7</div>
                        <div class="step-text"><strong>Result Communication:</strong> Present findings for clinical decision-making</div>
                    </div>
                </div>
            </div>

            <div class="research-note">
                <p><strong>üìä Clinical Group Analysis Foundation:</strong> ANOVA provides essential tools for comparing multiple medical treatments, evaluating healthcare interventions, and assessing group differences in clinical research. Understanding F-statistics, post-hoc testing, effect sizes, and assumption validation is crucial for conducting reliable group comparisons in healthcare settings. These methods enable evidence-based evaluation of treatment effectiveness and support clinical decision-making across diverse medical applications.</p>
            </div>
        </div>

        <!-- Canadian Clinical Group Analysis Section -->
        <div id="simulation" class="content-section">
            <h2 class="section-title">Canadian Clinical Group Analysis Laboratory</h2>

            <div class="control-panel">
                <h3 class="control-header">üìä ANOVA Simulator</h3>
                
                <div class="control-group">
                    <div class="form-group">
                        <label for="anovaModel">Canadian Medical Group Analysis Model</label>
                        <select id="anovaModel" onchange="updateAnovaModel()">
                            <option value="clinical_trial">Multi-arm Clinical Trial Analysis</option>
                            <option value="hospital_comparison">Hospital Performance Comparison</option>
                            <option value="drug_dosage">Drug Dosage Effectiveness Study</option>
                            <option value="device_evaluation">Medical Device Evaluation</option>
                            <option value="population_health">Population Health Group Analysis</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="anovaType">Analysis Type</label>
                        <select id="anovaType">
                            <option value="one_way">One-Way ANOVA</option>
                            <option value="two_way" selected>Two-Way ANOVA</option>
                            <option value="ancova">ANCOVA (with covariates)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="numGroups">Number of Groups</label>
                        <select id="numGroups">
                            <option value="3" selected>3 groups</option>
                            <option value="4">4 groups</option>
                            <option value="5">5 groups</option>
                            <option value="6">6 groups</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="sampleSizeAnova">Sample Size per Group</label>
                        <select id="sampleSizeAnova">
                            <option value="20">20 patients per group</option>
                            <option value="50" selected>50 patients per group</option>
                            <option value="100">100 patients per group</option>
                            <option value="200">200 patients per group</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="effectSizeAnova">Effect Size (Cohen's f)</label>
                        <input type="range" id="effectSizeAnova" min="0.1" max="0.8" step="0.1" value="0.3" onchange="updateEffectSizeAnovaDisplay()">
                        <span id="effectSizeAnovaValue">0.3</span> (medium effect)
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="generateAnovaData()">üìä Generate Groups</button>
                    <button class="btn btn-secondary" onclick="performAnovaAnalysis()">üîç Run ANOVA</button>
                    <button class="btn btn-accent" onclick="performPostHoc()">üéØ Post-hoc Tests</button>
                </div>
            </div>

            <!-- Medical Model Description -->
            <div id="anovaDescription" class="anova-info">
                <div class="results-header">Current Clinical Group Analysis Model</div>
                <div id="anovaText"></div>
                <div id="anovaModelMetrics" class="anova-metrics"></div>
            </div>

            <!-- Clinical Group Analysis Chart -->
            <div class="chart-container">
                <canvas id="anovaChart"></canvas>
            </div>
        </div>

        <!-- Model Diagnostics Section -->
        <div id="analysis" class="content-section">
            <h2 class="section-title">ANOVA Analysis & Diagnostics</h2>

            <div id="anovaResults" class="results-container">
                <div class="results-header">ANOVA Model Results</div>
                <div id="anovaTable"></div>
            </div>

            <div class="stats-grid" id="anovaStats">
                <!-- Dynamic statistics will be populated here -->
            </div>

            <div id="diagnosticsAnovaResults" class="results-container">
                <div class="results-header">üìä Model Diagnostics & Assumptions</div>
                <div id="diagnosticsAnovaTable"></div>
            </div>

            <!-- ANOVA Diagnostics Chart -->
            <div class="chart-container">
                <h3 style="text-align: center; margin-bottom: 45px; color: var(--secondary-red);">üîç ANOVA Diagnostics & Residual Analysis</h3>
                <canvas id="diagnosticsAnovaChart"></canvas>
            </div>
        </div>

        <!-- Assessment Mode Section -->
        <div id="assessment" class="content-section">
            <h2 class="section-title">ANOVA Assessment</h2>

            <div id="assessmentQuestion" class="decision-panel">
                <div class="decision-question">Loading ANOVA assessment...</div>
                <div class="decision-options" id="assessmentOptions">
                    <!-- Dynamic options will be populated -->
                </div>
                <button class="btn btn-primary" onclick="checkAnswer()" style="margin-top: 50px;">Submit Answer</button>
            </div>

            <div id="assessmentFeedback"></div>

            <div class="button-group" style="margin-top: 65px;">
                <button class="btn btn-secondary" onclick="generateNewQuestion()">üìù New Question</button>
                <button class="btn btn-accent" onclick="showExpertSolution()">üéì Show Group Analysis</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentAnovaModel = null;
        let currentAnovaChart = null;
        let diagnosticsAnovaChart = null;
        let selectedAnswer = null;
        let currentQuestion = null;

        // Medical ANOVA Model Definitions
        const anovaModels = {
            clinical_trial: {
                title: "Multi-arm Clinical Trial Analysis (Antihypertensive Study)",
                description: "Randomized controlled trial comparing effectiveness of four antihypertensive medications in reducing systolic blood pressure among Canadian adults with mild to moderate hypertension.",
                outcome: "Systolic BP Reduction (mmHg) after 12 weeks",
                groups: ["ACE Inhibitor", "ARB", "Beta-Blocker", "Calcium Channel Blocker"],
                population: "Adults aged 35-70 with hypertension (SBP 140-179 mmHg)",
                clinical_context: "Treatment selection and guideline development",
                expected_effect: "Medium effect (f = 0.30), ACE inhibitors superior",
                design: "Parallel group RCT with 1:1:1:1 randomization",
                primary_endpoint: "Mean reduction in systolic BP from baseline",
                validation: "ITT and per-protocol analysis, safety monitoring",
                clinical_application: "Evidence-based prescribing, treatment algorithms, personalized therapy"
            },
            hospital_comparison: {
                title: "Hospital Performance Comparison (Cardiac Surgery Outcomes)",
                description: "Multi-center analysis comparing 30-day mortality rates following cardiac surgery across five major cardiac centers in Canada, adjusting for patient case-mix.",
                outcome: "Risk-adjusted 30-day Mortality Rate (%)",
                groups: ["Academic Center A", "Academic Center B", "Regional Center C", "Community Center D", "Specialized Center E"],
                population: "Adult patients undergoing elective cardiac surgery",
                clinical_context: "Quality improvement and public reporting",
                expected_effect: "Small to medium effect (f = 0.25), center variation",
                design: "Retrospective cohort with risk adjustment",
                primary_endpoint: "30-day mortality rate, risk-adjusted",
                validation: "Case-mix adjustment, volume-outcome analysis",
                clinical_application: "Quality benchmarking, referral patterns, resource allocation"
            },
            drug_dosage: {
                title: "Drug Dosage Effectiveness Study (Anticoagulation)",
                description: "Dose-finding study evaluating optimal warfarin dosing strategy across different age groups for stroke prevention in atrial fibrillation patients.",
                outcome: "Time in Therapeutic Range (TTR) %",
                groups: ["Low Dose", "Standard Dose", "High Dose", "Pharmacogenetic-guided"],
                population: "Atrial fibrillation patients initiating warfarin therapy",
                clinical_context: "Dosing optimization and personalized medicine",
                expected_effect: "Large effect (f = 0.40), pharmacogenetic superior",
                design: "Factorial design with age stratification",
                primary_endpoint: "Percentage time in therapeutic INR range",
                validation: "Bleeding risk assessment, genetic testing correlation",
                clinical_application: "Dosing protocols, pharmacogenetic implementation, safety monitoring"
            },
            device_evaluation: {
                title: "Medical Device Evaluation (Blood Glucose Monitors)",
                description: "Comparative effectiveness study of four continuous glucose monitoring systems for diabetes management in Canadian patients with Type 1 diabetes.",
                outcome: "HbA1c Reduction (%) after 6 months",
                groups: ["CGM System A", "CGM System B", "CGM System C", "Standard Fingerstick"],
                population: "Adults with Type 1 diabetes, HbA1c ‚â•7.5%",
                clinical_context: "Technology assessment and reimbursement decisions",
                expected_effect: "Large effect (f = 0.35), CGM superior to fingerstick",
                design: "Crossover design with washout periods",
                primary_endpoint: "Change in HbA1c from baseline",
                validation: "Patient satisfaction, cost-effectiveness analysis",
                clinical_application: "Reimbursement policies, clinical guidelines, patient selection"
            },
            population_health: {
                title: "Population Health Group Analysis (BMI by Province)",
                description: "Cross-sectional analysis of body mass index differences across Canadian provinces using national health survey data, examining regional health disparities.",
                outcome: "Mean Body Mass Index (kg/m¬≤)",
                groups: ["Atlantic Provinces", "Quebec", "Ontario", "Prairie Provinces", "British Columbia"],
                population: "Canadian adults aged 18-64 from national health survey",
                clinical_context: "Health policy and regional intervention targeting",
                expected_effect: "Small effect (f = 0.20), regional variation",
                design: "Cross-sectional survey with stratified sampling",
                primary_endpoint: "Age-adjusted mean BMI by region",
                validation: "Survey weights, socioeconomic adjustment",
                clinical_application: "Public health policy, resource allocation, targeted interventions"
            }
        };

        // Assessment Questions (ANOVA focused)
        const assessmentQuestions = [
            {
                question: "In a clinical trial comparing 4 treatments with F(3,76) = 4.25, p = 0.008, what can you conclude?",
                options: [
                    "All four treatments are significantly different from each other",
                    "At least one treatment mean differs significantly from the others",
                    "The treatments explain 42.5% of the outcome variance",
                    "Treatment 1 is significantly better than treatments 2, 3, and 4"
                ],
                correct: 1,
                explanation: "A significant F-test in ANOVA indicates that at least one group mean differs from the others, but it doesn't specify which groups differ. Post-hoc testing is needed to determine specific pairwise differences. The F-statistic value doesn't directly indicate percentage of variance explained."
            },
            {
                question: "Why is multiple comparison correction (like Bonferroni) necessary after significant ANOVA?",
                options: [
                    "To increase the power of the individual tests",
                    "To control family-wise error rate and prevent Type I error inflation",
                    "To ensure equal sample sizes across groups",
                    "To improve the normality of residuals"
                ],
                correct: 1,
                explanation: "Multiple comparison corrections control the family-wise error rate (FWER) - the probability of making at least one Type I error when performing multiple pairwise comparisons. Without correction, the overall Œ± level would exceed 0.05, increasing false positive findings."
            },
            {
                question: "In two-way ANOVA, a significant interaction means:",
                options: [
                    "Both main effects must also be significant",
                    "The effect of one factor depends on the level of the other factor",
                    "The two factors are highly correlated",
                    "The model explains more than 50% of the variance"
                ],
                correct: 1,
                explanation: "A significant interaction indicates that the effect of one factor varies across levels of the other factor. This means the factors don't act independently - their combined effect differs from the sum of their individual effects. Main effects may or may not be significant when interactions are present."
            },
            {
                question: "Which ANOVA assumption violation is most serious for clinical research validity?",
                options: [
                    "Slight deviations from normality with large samples",
                    "Independence assumption violation due to clustering",
                    "Minor heterogeneity of variance with equal group sizes",
                    "Perfect normality with unequal group sizes"
                ],
                correct: 1,
                explanation: "Independence assumption violation (such as clustering or repeated measures) is most serious because it affects the validity of standard errors and p-values. ANOVA is relatively robust to normality and variance assumption violations, especially with larger samples and balanced designs."
            },
            {
                question: "What does eta-squared (Œ∑¬≤) = 0.12 indicate in a clinical trial?",
                options: [
                    "12% probability that the results are due to chance",
                    "12% of outcome variance is explained by treatment group differences",
                    "Treatment effect is 12 times larger than control",
                    "12% of patients showed clinically meaningful improvement"
                ],
                correct: 1,
                explanation: "Eta-squared represents the proportion of total variance in the outcome variable that is explained by the group differences. Œ∑¬≤ = 0.12 means treatment groups account for 12% of the variance in outcomes, indicating a medium-to-large effect size by Cohen's conventions."
            }
        ];

        // Navigation Functions
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
        }

        // ANOVA Model Management
        function updateAnovaModel() {
            const modelType = document.getElementById('anovaModel').value;
            const model = anovaModels[modelType];
            
            document.getElementById('anovaText').innerHTML = `
                <h3 style="color: var(--secondary-red); margin-bottom: 30px;">${model.title}</h3>
                <p><strong>Research Context:</strong> ${model.description}</p>
                <div class="research-note">
                    <p><strong>üìä Clinical Context:</strong> ${model.clinical_context}</p>
                </div>
                <p><strong>Outcome Variable:</strong> ${model.outcome}</p>
                <p><strong>Group Comparison:</strong> ${model.groups.join(', ')}</p>
                <p><strong>Target Population:</strong> ${model.population}</p>
                <p><strong>Expected Effect:</strong> ${model.expected_effect}</p>
                <p><strong>Study Design:</strong> ${model.design}</p>
                <p><strong>Primary Endpoint:</strong> ${model.primary_endpoint}</p>
                <p><strong>Validation Approach:</strong> ${model.validation}</p>
                <p><strong>Clinical Application:</strong> ${model.clinical_application}</p>
            `;
            
            updateAnovaModelMetrics();
        }

        function updateAnovaModelMetrics() {
            const anovaType = document.getElementById('anovaType').value;
            const container = document.getElementById('anovaModelMetrics');
            container.innerHTML = '';
            
            let metrics = [];
            switch(anovaType) {
                case 'one_way': metrics = ['F-statistic', 'p-value', 'Effect Size (Œ∑¬≤)', 'Post-hoc Tests']; break;
                case 'two_way': metrics = ['Main Effect A', 'Main Effect B', 'Interaction A√óB', 'Effect Sizes']; break;
                case 'ancova': metrics = ['Adjusted Means', 'Covariate Effect', 'Group Effect', 'Power Analysis']; break;
            }
            
            metrics.forEach((metric, index) => {
                const metricDiv = document.createElement('div');
                metricDiv.className = 'anova-metric-card';
                metricDiv.textContent = metric;
                container.appendChild(metricDiv);
            });
        }

        function updateEffectSizeAnovaDisplay() {
            const effectSize = document.getElementById('effectSizeAnova').value;
            const size = effectSize < 0.2 ? 'small' : 
                        effectSize < 0.5 ? 'medium' : 'large';
            document.getElementById('effectSizeAnovaValue').textContent = `${effectSize} (${size} effect)`;
        }

        // ANOVA Data Generation
        function generateAnovaData() {
            const modelType = document.getElementById('anovaModel').value;
            const analysisType = document.getElementById('anovaType').value;
            const numGroups = parseInt(document.getElementById('numGroups').value);
            const sampleSize = parseInt(document.getElementById('sampleSizeAnova').value);
            const effectSize = parseFloat(document.getElementById('effectSizeAnova').value);
            
            const model = anovaModels[modelType];
            
            currentAnovaModel = {
                model: model,
                analysisType: analysisType,
                numGroups: numGroups,
                sampleSize: sampleSize,
                effectSize: effectSize,
                data: []
            };

            // Generate clinical group data
            const groupMeans = [];
            const overallMean = 50; // Baseline value
            
            // Create group means based on effect size
            for (let i = 0; i < numGroups; i++) {
                const groupEffect = (i - (numGroups - 1) / 2) * effectSize * 10;
                groupMeans.push(overallMean + groupEffect);
            }
            
            // Generate patient data for each group
            for (let group = 0; group < numGroups; group++) {
                for (let patient = 0; patient < sampleSize; patient++) {
                    const patientData = {
                        group: group,
                        groupName: model.groups[group] || `Group ${group + 1}`,
                        outcome: generateNormal(groupMeans[group], 8), // SD = 8
                        age: 45 + generateNormal(0, 12),
                        sex: Math.random() < 0.52 ? 'Female' : 'Male'
                    };
                    currentAnovaModel.data.push(patientData);
                }
            }

            updateAnovaChart();
        }

        function generateNormal(mean, std) {
            // Box-Muller transformation
            const u1 = Math.random();
            const u2 = Math.random();
            const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
            return mean + z0 * std;
        }

        function updateAnovaChart() {
            if (!currentAnovaModel) return;
            
            const ctx = document.getElementById('anovaChart').getContext('2d');
            
            if (currentAnovaChart) {
                currentAnovaChart.destroy();
            }

            // Prepare data for box plot visualization
            const groupedData = {};
            const labels = [];
            const datasets = [];
            
            currentAnovaModel.data.forEach(d => {
                if (!groupedData[d.groupName]) {
                    groupedData[d.groupName] = [];
                    labels.push(d.groupName);
                }
                groupedData[d.groupName].push(d.outcome);
            });

            // Create box plot style data (showing means and ranges)
            const boxPlotData = labels.map((label, index) => {
                const data = groupedData[label];
                const mean = data.reduce((sum, val) => sum + val, 0) / data.length;
                const sorted = data.sort((a, b) => a - b);
                const q1 = sorted[Math.floor(sorted.length * 0.25)];
                const median = sorted[Math.floor(sorted.length * 0.5)];
                const q3 = sorted[Math.floor(sorted.length * 0.75)];
                
                return {
                    x: index,
                    y: mean,
                    min: Math.min(...data),
                    max: Math.max(...data),
                    q1: q1,
                    median: median,
                    q3: q3
                };
            });

            // Create scatter plot for individual points
            const scatterData = currentAnovaModel.data.map((d, index) => ({
                x: labels.indexOf(d.groupName) + (Math.random() - 0.5) * 0.3, // Add jitter
                y: d.outcome
            }));

            currentAnovaChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Individual Patients',
                            data: scatterData,
                            backgroundColor: 'rgba(0, 172, 193, 0.6)',
                            borderColor: '#00ACC1',
                            borderWidth: 1,
                            pointRadius: 3
                        },
                        {
                            label: 'Group Means',
                            data: boxPlotData,
                            backgroundColor: 'rgba(255, 143, 0, 0.8)',
                            borderColor: '#FF8F00',
                            borderWidth: 3,
                            pointRadius: 8,
                            pointStyle: 'rect'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${currentAnovaModel.model.title} - Group Comparisons`,
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        x: { 
                            title: { display: true, text: 'Treatment Groups' },
                            ticks: {
                                callback: function(value, index) {
                                    return labels[index] || '';
                                }
                            }
                        },
                        y: { title: { display: true, text: currentAnovaModel.model.outcome } }
                    }
                }
            });
        }

        // ANOVA Analysis
        function performAnovaAnalysis() {
            if (!currentAnovaModel) {
                alert('Please generate ANOVA data first');
                return;
            }

            const data = currentAnovaModel.data;
            const numGroups = currentAnovaModel.numGroups;
            
            // Calculate group means and overall mean
            const groupMeans = [];
            const groupSizes = [];
            const groupSums = [];
            
            for (let i = 0; i < numGroups; i++) {
                const groupData = data.filter(d => d.group === i);
                const mean = groupData.reduce((sum, d) => sum + d.outcome, 0) / groupData.length;
                groupMeans.push(mean);
                groupSizes.push(groupData.length);
                groupSums.push(groupData.reduce((sum, d) => sum + d.outcome, 0));
            }
            
            const overallMean = data.reduce((sum, d) => sum + d.outcome, 0) / data.length;
            const totalN = data.length;
            
            // Calculate Sum of Squares
            let SSB = 0; // Between groups
            let SSW = 0; // Within groups
            let SST = 0; // Total
            
            // Between groups SS
            for (let i = 0; i < numGroups; i++) {
                SSB += groupSizes[i] * Math.pow(groupMeans[i] - overallMean, 2);
            }
            
            // Within groups SS and Total SS
            data.forEach(d => {
                const groupMean = groupMeans[d.group];
                SSW += Math.pow(d.outcome - groupMean, 2);
                SST += Math.pow(d.outcome - overallMean, 2);
            });
            
            // Degrees of freedom
            const dfB = numGroups - 1;
            const dfW = totalN - numGroups;
            const dfT = totalN - 1;
            
            // Mean squares
            const MSB = SSB / dfB;
            const MSW = SSW / dfW;
            
            // F-statistic
            const fStatistic = MSB / MSW;
            
            // Simulate p-value (simplified)
            const pValue = fStatistic > 3.5 ? 0.001 : 
                          fStatistic > 2.8 ? 0.01 : 
                          fStatistic > 2.3 ? 0.05 : 
                          fStatistic > 1.8 ? 0.10 : 0.25;
            
            // Effect size (eta-squared)
            const etaSquared = SSB / SST;
            
            const anovaResults = {
                fStatistic: fStatistic,
                pValue: pValue,
                etaSquared: etaSquared,
                SSB: SSB,
                SSW: SSW,
                SST: SST,
                MSB: MSB,
                MSW: MSW,
                dfB: dfB,
                dfW: dfW,
                dfT: dfT,
                groupMeans: groupMeans,
                groupNames: currentAnovaModel.model.groups.slice(0, numGroups)
            };

            displayAnovaResults(anovaResults);
        }

        function displayAnovaResults(results) {
            const model = currentAnovaModel.model;
            const analysisType = currentAnovaModel.analysisType;
            const significance = results.pValue < 0.05 ? '‚úÖ Significant' : '‚ùå Not Significant';
            const effectMagnitude = results.etaSquared > 0.14 ? 'Large' : 
                                   results.etaSquared > 0.06 ? 'Medium' : 'Small';
            
            let groupMeansTable = '';
            results.groupNames.forEach((name, index) => {
                const mean = results.groupMeans[index];
                groupMeansTable += `
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px; padding: 10px 0; ${index % 2 === 1 ? 'background: rgba(0, 172, 193, 0.1);' : ''}">
                        <div>${name}</div>
                        <div class="f-statistic-display">${mean.toFixed(2)}</div>
                    </div>
                `;
            });
            
            document.getElementById('anovaTable').innerHTML = `
                <h4>üìä ANOVA Model Results</h4>
                <div style="background: var(--primary-teal); color: white; padding: 20px; border-radius: 15px; margin-bottom: 25px; text-align: center;">
                    <strong>${analysisType.replace('_', ' ').toUpperCase()}</strong><br>
                    Outcome: ${model.outcome}<br>
                    F(${results.dfB}, ${results.dfW}) = ${results.fStatistic.toFixed(3)}, p = ${results.pValue < 0.001 ? '<0.001' : results.pValue.toFixed(3)}
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 35px; margin: 30px 0;">
                    <div style="font-family: 'Fira Code', monospace; background: var(--pale-teal); padding: 25px; border-radius: 15px;">
                        <h5>ANOVA Table</h5>
                        <table style="width: 100%; margin-top: 15px;">
                            <tr style="border-bottom: 2px solid #ccc;">
                                <th>Source</th><th>df</th><th>SS</th><th>MS</th><th>F</th><th>p</th>
                            </tr>
                            <tr>
                                <td>Between</td><td>${results.dfB}</td><td>${results.SSB.toFixed(1)}</td><td>${results.MSB.toFixed(1)}</td><td>${results.fStatistic.toFixed(3)}</td><td>${results.pValue.toFixed(3)}</td>
                            </tr>
                            <tr>
                                <td>Within</td><td>${results.dfW}</td><td>${results.SSW.toFixed(1)}</td><td>${results.MSW.toFixed(1)}</td><td>-</td><td>-</td>
                            </tr>
                            <tr style="border-top: 2px solid #ccc;">
                                <td>Total</td><td>${results.dfT}</td><td>${results.SST.toFixed(1)}</td><td>-</td><td>-</td><td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="background: var(--pale-teal); padding: 25px; border-radius: 15px;">
                        <h5>Group Means</h5>
                        <div style="margin-top: 15px;">
                            ${groupMeansTable}
                        </div>
                        <p style="margin-top: 15px;"><strong>Œ∑¬≤ = ${(results.etaSquared * 100).toFixed(1)}%</strong> (${effectMagnitude} effect)</p>
                    </div>
                </div>
                
                <div class="group-analysis-highlight">
                    <p><strong>üìä Clinical ANOVA Interpretation:</strong> 
                    The analysis ${results.pValue < 0.05 ? 'demonstrates significant differences' : 'shows no significant differences'} 
                    between treatment groups (${significance}). The effect size (Œ∑¬≤ = ${(results.etaSquared * 100).toFixed(1)}%) 
                    indicates a ${effectMagnitude.toLowerCase()} clinical effect. 
                    ${results.pValue < 0.05 ? 'Post-hoc testing is required to identify specific group differences for clinical decision-making.' : 'No further pairwise comparisons are needed.'} 
                    <span class="canada-anova">Canadian clinical validation</span> 
                    requires replication and assessment of clinical significance beyond statistical findings.
                    </p>
                </div>
            `;

            // Update ANOVA statistics display
            document.getElementById('anovaStats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${results.fStatistic.toFixed(3)}</div>
                    <div class="stat-label">F-statistic</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${results.pValue < 0.001 ? '<0.001' : results.pValue.toFixed(3)}</div>
                    <div class="stat-label">p-value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${(results.etaSquared * 100).toFixed(1)}%</div>
                    <div class="stat-label">Eta-squared (Œ∑¬≤)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${effectMagnitude}</div>
                    <div class="stat-label">Effect Size</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${results.dfB}</div>
                    <div class="stat-label">Between df</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${results.dfW}</div>
                    <div class="stat-label">Within df</div>
                </div>
            `;
        }

        function performPostHoc() {
            if (!currentAnovaModel) {
                alert('Please perform ANOVA analysis first');
                return;
            }

            generateDiagnosticsAnovaChart();
            displayAnovaAssumptions();
        }

        function generateDiagnosticsAnovaChart() {
            const ctx = document.getElementById('diagnosticsAnovaChart').getContext('2d');
            
            if (diagnosticsAnovaChart) {
                diagnosticsAnovaChart.destroy();
            }

            // Generate residual vs fitted plot data
            const residualData = currentAnovaModel.data.map((d, i) => {
                const groupMean = currentAnovaModel.data.filter(dp => dp.group === d.group)
                    .reduce((sum, dp) => sum + dp.outcome, 0) / 
                    currentAnovaModel.data.filter(dp => dp.group === d.group).length;
                const residual = d.outcome - groupMean;
                return { x: groupMean, y: residual };
            });

            diagnosticsAnovaChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Residuals',
                            data: residualData,
                            backgroundColor: 'rgba(0, 172, 193, 0.6)',
                            borderColor: '#00ACC1',
                            borderWidth: 2,
                            pointRadius: 4
                        },
                        {
                            label: 'Zero Line',
                            data: [{x: Math.min(...residualData.map(d => d.x)), y: 0}, 
                                  {x: Math.max(...residualData.map(d => d.x)), y: 0}],
                            type: 'line',
                            borderColor: '#DC2626',
                            borderDash: [10, 5],
                            borderWidth: 2,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ANOVA Diagnostics: Residuals vs Group Means',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Group Means (Fitted Values)' } },
                        y: { title: { display: true, text: 'Residuals' } }
                    }
                }
            });
        }

        function displayAnovaAssumptions() {
            const model = currentAnovaModel.model;
            const numGroups = currentAnovaModel.numGroups;
            
            // Simulate assumption test results
            const normalityTest = Math.random() > 0.3 ? 'Shapiro-Wilk: p = 0.12 (Normal)' : 'Shapiro-Wilk: p = 0.02 (Non-normal)';
            const homogeneityTest = Math.random() > 0.25 ? "Levene's test: p = 0.18 (Equal variances)" : "Levene's test: p = 0.03 (Unequal variances)";
            const independenceCheck = 'Residual patterns: No clustering detected';
            
            document.getElementById('diagnosticsAnovaTable').innerHTML = `
                <h4>üìä ANOVA Assumptions & Model Diagnostics</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin: 40px 0;">
                    <div class="stat-card" style="padding: 35px;">
                        <h5>Assumption Testing</h5>
                        <div class="posthoc-info">
                            <div class="posthoc-metric">Normality<br>‚úÖ Met</div>
                            <div class="posthoc-metric">Equal Variance<br>‚úÖ Met</div>
                            <div class="posthoc-metric">Independence<br>‚úÖ Met</div>
                        </div>
                        <p><strong>Normality:</strong> ${normalityTest}</p>
                        <p><strong>Homogeneity:</strong> ${homogeneityTest}</p>
                        <p><strong>Independence:</strong> ${independenceCheck}</p>
                    </div>
                    
                    <div class="stat-card" style="padding: 35px;">
                        <h5>Post-hoc Comparisons</h5>
                        <p><strong>Method:</strong> Tukey HSD (family-wise Œ± = 0.05)</p>
                        <p><strong>Significant Pairs:</strong> ${Math.floor(Math.random() * 3) + 1} of ${numGroups * (numGroups - 1) / 2} comparisons</p>
                        <p><strong>Effect Sizes:</strong> Cohen's d ranging 0.2-0.8</p>
                        <p><strong>Clinical Relevance:</strong> ${model.expected_effect}</p>
                        <p><strong>Recommendations:</strong> Primary analysis supports ${model.clinical_application.split(',')[0]}</p>
                    </div>
                </div>
                
                <div class="group-analysis-highlight">
                    <p><strong>üìä Advanced ANOVA Diagnostic Interpretation:</strong> 
                    Model assumptions are adequately met for valid inference. Residual analysis indicates appropriate model fit with no systematic patterns suggesting assumption violations. 
                    Post-hoc testing reveals specific treatment differences requiring clinical interpretation for implementation. 
                    <span class="canada-anova">Canadian healthcare applications</span> 
                    require consideration of effect sizes, clinical significance, and real-world implementation factors beyond statistical significance.
                    </p>
                </div>
            `;
        }

        // Assessment Functions
        function generateNewQuestion() {
            currentQuestion = assessmentQuestions[Math.floor(Math.random() * assessmentQuestions.length)];
            selectedAnswer = null;
            
            document.querySelector('.decision-question').textContent = currentQuestion.question;
            
            const optionsContainer = document.getElementById('assessmentOptions');
            optionsContainer.innerHTML = '';
            
            currentQuestion.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'decision-option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            document.getElementById('assessmentFeedback').innerHTML = '';
        }

        function selectAnswer(answerIndex) {
            selectedAnswer = answerIndex;
            
            document.querySelectorAll('.decision-option').forEach((option, index) => {
                option.classList.toggle('selected', index === answerIndex);
            });
        }

        function checkAnswer() {
            if (selectedAnswer === null) {
                alert('Please select an answer first');
                return;
            }
            
            const isCorrect = selectedAnswer === currentQuestion.correct;
            const feedbackClass = isCorrect ? 'feedback-success' : 'feedback-danger';
            const feedbackTitle = isCorrect ? '‚úì Correct!' : '‚úó Incorrect';
            
            document.getElementById('assessmentFeedback').innerHTML = `
                <div class="${feedbackClass}">
                    <h4>${feedbackTitle}</h4>
                    <p><strong>Explanation:</strong> ${currentQuestion.explanation}</p>
                    <p><strong>Correct Answer:</strong> ${currentQuestion.options[currentQuestion.correct]}</p>
                </div>
            `;
        }

        function showExpertSolution() {
            if (!currentQuestion) {
                generateNewQuestion();
                return;
            }
            
            document.getElementById('assessmentFeedback').innerHTML = `
                <div class="feedback-success">
                    <h4>üìä Advanced ANOVA Analysis</h4>
                    <p><strong>Correct Answer:</strong> ${currentQuestion.options[currentQuestion.correct]}</p>
                    <p><strong>ANOVA Insight:</strong> ${currentQuestion.explanation}</p>
                    <p><strong>Clinical Application:</strong> ANOVA provides essential tools for comparing multiple medical treatments and evaluating group differences in clinical research. Understanding F-statistics, post-hoc testing, effect sizes, and assumption validation is crucial for conducting reliable group comparisons in healthcare settings. These methods enable evidence-based evaluation of treatment effectiveness and support clinical decision-making across diverse medical applications.</p>
                </div>
            `;
        }

        // Initialize page
        window.addEventListener('load', function() {
            updateAnovaModel();
            generateNewQuestion();
        });
    </script>
</body>
</html>
